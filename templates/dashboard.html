{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
    <!-- Welcome -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white shadow-sm rounded-3">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h3>Welcome, {{ username }} ðŸ‘‹</h3>
                        <p class="mb-0">Manage your health and appointments with ease.</p>
                    </div>
                    <div>
                        <i class="bi bi-heart-pulse-fill" style="font-size: 3rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm h-100 text-center p-3">
                <i class="bi bi-clipboard-plus mb-2" style="font-size: 2rem;"></i>
                <h5>Symptom Checker</h5>
                <a href="{{ url_for('diagnosis') }}" class="btn btn-primary btn-sm mt-2">Go</a>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm h-100 text-center p-3">
                <i class="bi bi-person-badge mb-2" style="font-size: 2rem;"></i>
                <h5>Find Doctors</h5>
                <a href="{{ url_for('doctors') }}" class="btn btn-primary btn-sm mt-2">Go</a>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm h-100 text-center p-3">
                <i class="bi bi-lightbulb mb-2" style="font-size: 2rem;"></i>
                <h5>Health Tips</h5>
                <a href="{{ url_for('tips') }}" class="btn btn-primary btn-sm mt-2">Go</a>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card shadow-sm h-100 text-center p-3">
                <i class="bi bi-calendar-check mb-2" style="font-size: 2rem;"></i>
                <h5>Book Appointment</h5>
                <a href="{{ url_for('appointment') }}" class="btn btn-primary btn-sm mt-2">Go</a>
            </div>
        </div>
    </div>

    <!-- Appointments -->
    <div class="row">
        <div class="col-12">
            <h4 class="mb-3">Your Upcoming Appointments</h4>
            {% if appointments %}
            <table class="table table-striped table-hover shadow-sm rounded-3">
                <thead class="table-primary">
                    <tr>
                        <th>Patient Name</th>
                        <th>Doctor</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doctor, date, name in appointments %}
                    <tr>
                        <td>{{ name }}</td>
                        <td>{{ doctor }}</td>
                        <td>{{ date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="alert alert-info">You have no upcoming appointments.</div>
            {% endif %}
        </div>
    </div>

    <!-- Stats -->
    <div class="row mt-4">
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Total Appointments</h5>
                <p class="display-6">{{ appointments|length }}</p>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Doctors Available</h5>
                <p class="display-6">5+</p>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Tips Available</h5>
                <p class="display-6">4</p>
            </div>
        </div>
    </div>

    <!-- Chart -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm p-3">
                <h5 class="mb-3">Your Appointment History</h5>
                <canvas id="appointmentsChart" height="100"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    const labels = {{ chart_labels|default([])|tojson }};
    const values = {{ chart_values|default([])|tojson }};
    const ctx = document.getElementById('appointmentsChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Appointments per Month',
                data: values,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

{% endblock %}
